<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>워크스페이스 - 메뉴리스트 관리</title>
  <link rel="stylesheet" href="../asset/style.css">
  <link rel="stylesheet" href="../asset/modal.css">
</head>

<body class="page-workspace-menu-setting">
  <div class="container">
    <!-- 왼쪽 메뉴바 -->
    <div class="sidebar">
      <div class="logo">
        <div class="logo-icon">T</div>
        <div class="logo-text">
          <div class="logo-title">Timbel</div>
          <div class="logo-url">timbel.net</div>
        </div>
        <button class="logout-btn" title="로그아웃">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_logout)">
              <path
                d="M12 3H6.66667C5.95942 3 5.28115 3.27092 4.78105 3.75315C4.28095 4.23539 4 4.88944 4 5.57143V18.4286C4 19.1106 4.28095 19.7646 4.78105 20.2468C5.28115 20.7291 5.95942 21 6.66667 21H12"
                stroke="#4D5256" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M15.75 8.25L19.5 12M19.5 12L15.75 15.75M19.5 12H8" stroke="#4D5256" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round" />
            </g>
            <defs>
              <clipPath id="clip0_logout">
                <rect width="24" height="24" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </button>
      </div>

      <div class="menu-section">
        <h3>시스템관리</h3>
        <ul>
          <li><a href="workspace.html">워크스페이스 관리</a></li>
          <li><a href="system_user.html">사용자 관리</a></li>
          <li><a href="menu_setting.html">메뉴 생성 관리</a></li>
          <li><a href="group_setting.html">메뉴 권한 관리</a></li>
          <li><a href="system_stats_usage.html">사용량 통계</a></li>
          <li><a href="system_stats_user.html">사용자별 통계</a></li>
        </ul>
      </div>

      <div class="menu-section">
        <div class="menu-section-header">
          <h3>워크스페이스</h3>
        </div>
        <ul>
          <li><a href="workspace_permission.html">기능 권한 관리</a></li>
          <li><a href="workspace_menu_setting.html" class="active">메뉴리스트 관리</a></li>
          <li><a href="workspace_group_setting.html">메뉴 권한 관리</a></li>
          <li><a href="user.html">사용자 관리</a></li>
          <li><a href="logo.html">로고 이미지 관리</a></li>
          <li><a href="meet_template.html">회의 템플릿 관리</a></li>
          <li><a href="prompt.html">프롬프트 관리</a></li>
          <li><a href="consent.html">동의서 관리</a></li>
          <li><a href="calendar.html">캘린더 관리</a></li>
          <li class="menu-separator"></li>
          <li><a href="login_history.html">사용자 접속 이력</a></li>
          <li><a href="download_history.html">다운로드 이력</a></li>
          <li><a href="user_consent_history.html">사용자 동의 이력</a></li>
          <li><a href="setting_change_history.html">설정변경 이력</a></li>
          <li><a href="meeting.html">회의록 관리</a></li>
          <li><a href="dictionary.html">사전 관리</a></li>
          <li><a href="notice.html">공지사항 관리</a></li>
          <li><a href="stats_usage.html">사용량 통계</a></li>
          <li><a href="stats_user.html">사용자별 통계</a></li>
        </ul>
      </div>
    </div>

    <!-- 오른쪽 콘텐츠 영역 -->
    <div class="content">
      <div class="content-header">
        <div class="breadcrumb">메뉴리스트 관리</div>
      </div>

      <div class="content-body">
        <div class="menu-management-container">
          <!-- 메뉴정보 헤더 -->
          <div class="menu-title-header">
            <div class="menu-title-section">
              <h3 class="menu-subtitle">메뉴 관리</h3>
              <span class="menu-total-count">총 17개</span>
            </div>
            <div class="menu-action-section">
              <div class="menu-action-buttons">
                <button class="btn-reset" id="resetBtn">초기화</button>
                <button class="btn-add-separator" id="addSeparatorBtn">구분선 추가</button>
                <button class="btn-save" id="saveBtn">저장</button>
              </div>
            </div>
          </div>

          <!-- 액션 버튼들 -->


          <!-- 드래그 가능한 메뉴 테이블 -->
          <div class="drag-table-container">
            <table class="drag-sortable-table">
              <thead>
                <tr>
                  <th width="50" class="drag-column"></th>
                  <th width="250">메뉴명</th>
                  <th width="100">사용여부</th>
                  <th width="300">URL</th>
                </tr>
              </thead>
              <tbody id="sortable-menu-list">
                <tr draggable="true" data-menu-id="1" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">공통관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="2" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">기능 권한 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="3" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사용자 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="4" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">로고 이미지 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="5" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">회의 템플릿 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="6" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">프롬프트 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="7" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">동의서 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="8" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">캘린더 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="9" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사용자 접속 이력</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="10" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">다운로드 이력</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="11" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사용자 동의 이력</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="12" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">설정변경 이력</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="13" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">회의록 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="14" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사전 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="15" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">공지사항 관리</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="16" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사용량 통계</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
                <tr draggable="true" data-menu-id="17" class="draggable-row">
                  <td class="drag-handle" title="드래그하여 순서 변경">☰</td>
                  <td class="menu-name">사용자별 통계</td>
                  <td class="menu-status"><label class="switch"><input type="checkbox" checked><span
                        class="slider"></span></label></td>
                  <td class="menu-url">-</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 드래그 앤 드롭 스타일 -->
  <style>
    /* 드래그 테이블 스타일 */
    .drag-sortable-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .drag-sortable-table th {
      background: #f8f9fa;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 1px solid #e5e7eb;
    }

    .drag-sortable-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #f3f4f6;
      vertical-align: middle;
    }

    .draggable-row {
      cursor: move;
      transition: all 0.2s ease;
    }

    .draggable-row:hover {
      background: #f8f9fa;
    }

    .draggable-row.dragging {
      opacity: 0.5;
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .drag-handle {
      cursor: grab;
      color: #9ca3af;
      font-weight: bold;
      text-align: center;
      user-select: none;
      font-size: 18px;
      line-height: 1;
      padding: 8px;
      border-bottom: 1px solid #f3f4f6;
    }

    .drag-handle:hover {
      color: #374151;
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    .drag-over-top {
      border-top: 3px solid #0066ff;
    }

    .drag-over-bottom {
      border-bottom: 3px solid #0066ff;
    }

    /* 구분선 행 스타일 */
    .separator-row {
      background: transparent;
      height: 30px;
      cursor: move;
    }

    .separator-row:hover {
      background: #f8f9fa;
    }

    .separator-row.dragging {
      opacity: 0.5;
      background: #e5e7eb;
    }

    .separator-row td {
      border-bottom: none;
      vertical-align: middle;
      padding: 8px 16px;
    }

    .separator-content {
      padding: 0;
    }

    .separator-line {
      width: 100%;
      height: 2px;
      background: repeating-linear-gradient(to right,
          #d1d5db 0px,
          #d1d5db 8px,
          transparent 8px,
          transparent 16px);
      margin: 10px 0;
    }

    .separator-text {
      color: #6b7280;
      font-style: italic;
      text-align: center;
    }

    .menu-management-container {}

    .menu-title-header {
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
    }

    .menu-action-section {}

    .menu-title-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-subtitle {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #111827;
    }

    .menu-total-count {
      background: #f3f4f6;
      color: #6b7280;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .menu-action-buttons {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .drag-table-container {
      overflow: hidden;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    /* 사이드바 메뉴 구분선 스타일 */
    .menu-separator {
      height: 1px;
      background: #e5e7eb;
      margin: 0 16px;
      padding: 0;
      list-style: none;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // 전역 드래그 변수
      let draggedRow = null;

      // 드래그 앤 드롭 기능 초기화
      initializeDragAndDrop();

      // 버튼 기능 초기화
      initializeButtons();

      // 드래그 앤 드롭 기능 초기화 함수
      function initializeDragAndDrop() {
        const tbody = document.getElementById('sortable-menu-list');
        const rows = tbody.querySelectorAll('tr.draggable-row');

        rows.forEach(row => {
          addDragEventsToRow(row);
        });
      }

      // 개별 행에 드래그 이벤트를 추가하는 함수
      function addDragEventsToRow(row) {
        const tbody = document.getElementById('sortable-menu-list');

        // 드래그 시작
        row.addEventListener('dragstart', function (e) {
          draggedRow = this;
          this.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', this.outerHTML);
        });

        // 드래그 종료
        row.addEventListener('dragend', function (e) {
          this.classList.remove('dragging');
          draggedRow = null;
          updateMenuOrder();
        });

        // 드래그 오버
        row.addEventListener('dragover', function (e) {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';

          if (draggedRow && draggedRow !== this) {
            const rect = this.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;

            if (e.clientY < midpoint) {
              this.classList.add('drag-over-top');
              this.classList.remove('drag-over-bottom');
            } else {
              this.classList.add('drag-over-bottom');
              this.classList.remove('drag-over-top');
            }
          }
        });

        // 드래그 리브
        row.addEventListener('dragleave', function (e) {
          this.classList.remove('drag-over-top', 'drag-over-bottom');
        });

        // 드롭
        row.addEventListener('drop', function (e) {
          e.preventDefault();
          this.classList.remove('drag-over-top', 'drag-over-bottom');

          if (draggedRow && draggedRow !== this) {
            const rect = this.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;

            if (e.clientY < midpoint) {
              tbody.insertBefore(draggedRow, this);
            } else {
              tbody.insertBefore(draggedRow, this.nextSibling);
            }
          }
        });
      }

      // 메뉴 순서 업데이트 함수
      function updateMenuOrder() {
        const allRows = document.querySelectorAll('#sortable-menu-list tr');
        const menuRows = document.querySelectorAll('#sortable-menu-list tr:not(.separator-row)');

        // 메뉴 행들의 순서 업데이트
        menuRows.forEach((row, index) => {
          row.setAttribute('data-order', index + 1);
        });

        // 총 개수 업데이트 (구분선 제외)
        const totalCount = document.querySelector('.menu-total-count');
        if (totalCount) {
          totalCount.textContent = `총 ${menuRows.length}개`;
        }

        console.log('메뉴 순서 업데이트됨 - 메뉴:', menuRows.length, '전체:', allRows.length);
      }

      // 버튼 기능 초기화 함수
      function initializeButtons() {
        // 초기화 버튼
        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
          resetBtn.addEventListener('click', function () {
            if (confirm('모든 변경사항을 초기화하시겠습니까?')) {
              location.reload();
            }
          });
        }

        // 저장 버튼
        const saveBtn = document.getElementById('saveBtn');
        if (saveBtn) {
          saveBtn.addEventListener('click', function () {
            if (confirm('현재 메뉴 설정을 저장하시겠습니까?')) {
              saveMenuOrder();
            }
          });
        }

        // 구분선 추가 버튼
        const addSeparatorBtn = document.getElementById('addSeparatorBtn');
        if (addSeparatorBtn) {
          addSeparatorBtn.addEventListener('click', function () {
            addMenuSeparator();
          });
        }
      }

      // 메뉴 순서 저장 함수
      function saveMenuOrder() {
        const rows = document.querySelectorAll('#sortable-menu-list tr.draggable-row');
        const menuOrder = [];

        rows.forEach((row, index) => {
          const menuData = {
            id: row.getAttribute('data-menu-id'),
            name: row.querySelector('.menu-name').textContent,
            order: index + 1,
            enabled: row.querySelector('.menu-status input[type="checkbox"]').checked,
            url: row.querySelector('.menu-url').textContent
          };
          menuOrder.push(menuData);
        });

        console.log('저장할 메뉴 순서:', menuOrder);
        alert('메뉴 설정이 저장되었습니다.');
      }

      // 구분선 추가 함수
      function addMenuSeparator() {
        const tbody = document.getElementById('sortable-menu-list');
        const separatorCount = document.querySelectorAll('.separator-row').length + 1;

        const separatorRow = document.createElement('tr');
        separatorRow.className = 'separator-row draggable-row';
        separatorRow.setAttribute('draggable', 'true');
        separatorRow.setAttribute('data-separator-id', `sep-${separatorCount}`);
        separatorRow.innerHTML = `
          <td class="separator-content" colspan="4">
            <div class="separator-line"></div>
          </td>
        `;

        tbody.appendChild(separatorRow);

        // 새로 추가된 구분선에도 드래그 이벤트 적용
        addDragEventsToRow(separatorRow);
        updateMenuOrder();

        console.log('구분선이 추가되었습니다.');
      }

      // 구분선 더블클릭으로 제거
      function initializeSeparatorRemoval() {
        document.addEventListener('dblclick', function (e) {
          const separatorRow = e.target.closest('.separator-row');
          if (separatorRow) {
            if (confirm('구분선을 삭제하시겠습니까?')) {
              separatorRow.remove();
              updateMenuOrder();
            }
          }
        });
      }

      // 구분선 제거 기능 초기화
      initializeSeparatorRemoval();
    });
  </script>

  <script src="../asset/menu.js"></script>
  <script src="../asset/main.js"></script>
</body>

</html>